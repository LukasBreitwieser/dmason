<!--
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../../neon-animation/neon-animatable.html">
<link rel="import" href="../../neon-animation/animations/ripple-animation.html">
<link rel="import" href="../../neon-animation/animations/hero-animation.html">
<link rel="import" href="../../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../neon-animation/animations/transform-animation.html">
<link rel="inport" href="simulation-info.html">

<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../../paper-item/paper-item-body.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../../paper-card/paper-card.html">


<link rel="import" href="../../neon-animation/neon-animated-pages.html">
<link rel="import" href="../../neon-animation/neon-animations.html">
<link rel="import" href="listFile/list-view.html">
<link rel="import" href="listFile/full-log-view.html">

<dom-module id="fullsize-page-with-card">
    <template>
        <style>

            :host {
                display: block;
                color:#bdced7;
                font-size: medium;
            }
            .fixed {
                background-color: #646767;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                min-width: 1024px;
                min-height: 768px;
                overflow-x: visible;
            }

            .dinamic_container{
                position: relative;
                margin: 50px auto auto 25%;
                width: 780px;
                height: 580px;
                min-width: 780px;
                min-height: 580px;
                background-color: #3f4242;
            }
            .card {
                width: 780px;
                height: 580px;
                min-width: 780px;
                min-height: 580px;
                @apply(--layout-horizontal);
            }

            .simulation-container{
                width: 350px;
                height: 560px;
                @apply(--layout-vertical);
            }


            #back_button{
                float: left;

            }

            paper-card {
                --paper-card-header-color: #bdced7;
                background-color: transparent;
            }

            div.animation-log-container{
                width:100%;
                min-width: 300px;
                margin-left: 30px;

            }
            neon-animated-pages {
                height: 550px;
            }
            paper-button[raised]{
                width: 150px;
                border-radius: 50px;
            }

            .download-button-container{
                cursor: pointer;
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }


        </style>
     <div class="layout vertical center-justified">
        <div id="fixed" class="fixed horizontal layout">
            <div on-click="go_back">
                <paper-button><iron-icon icon="arrow-back"></iron-icon> BACK</paper-button>
            </div>
            <div class="flex"></div>
            <div on-click="go_next">
                <paper-button> NEXT<iron-icon icon="arrow-forward"></iron-icon></paper-button>
            </div>

        </div>

         <neon-animated-pages id="system_info" class="dinamic_container" selected="0">
                 <div id="card" class="card">
                     <div class="simulation-container">
                         <paper-card id="sim_info" heading="Simulation Info">
                             <div class="card-content">
                                 <simulation-info sim="{{sim}}"></simulation-info>
                             </div>
                         </paper-card>
                         <div class="flex"></div>
                         <div class="download-button-container" on-click="downloadLog">
                             <form id="download_log_form"method="POST" action="/downloadLogs?id={{sim.id}}">
                                 <paper-icon-button icon="file-download" raised></paper-icon-button>
                                 <span>Download Logs</span>
                             </form>
                         </div>
                     </div>
                     <div class="flex"></div>
                     <div class="animation-log-container">
                         <neon-animated-pages id="log_files" selected="0">
                             <list-view list_log="{{listFile}}" on-item-click="_onItemClick"></list-view>
                             <full-log-view id="full_file" on-close="_onClose"></full-log-view>
                         </neon-animated-pages>
                     </div>
                </div>


                <div id="task_manager" class="card">
                    <div id="SystemCPUMonitor" style="height: 300px; min-width: 780px;;"></div>
                </div>

         </neon-animated-pages>




     </div>
    </template>

</dom-module>

<script>
    Polymer({
        is: 'fullsize-page-with-card',
        behaviors: [
            Polymer.NeonSharedElementAnimatableBehavior
        ],
        properties: {
            sim:{
                type: Object
            },
            listFile:{
                type:Array
            },
            sharedElements: {
                type: Object,
                value: function() {
                    return {
                        'hero': this.$.card,
                        'ripple': this.$.fixed
                    }
                }
            },
            animationConfig: {
                type: Object,
                value: function() {
                    return {
                        'entry': [{
                            name: 'ripple-animation',
                            id: 'ripple',
                            toPage: this,
                        }, {
                            name: 'hero-animation',
                            id: 'hero',
                            toPage: this,
                            timing: {
                                delay: 150
                            }
                        }],
                        'exit': [{
                            name: 'fade-out-animation',
                            node: this.$.fixed
                        }, {
                            name: 'transform-animation',
                            transformFrom: 'none',
                            transformTo: 'translate(0px,-200vh) scale(0.9,1)',
                            node: this.$.system_info
                        }]
                    }
                }
            }
        },
        go_back:function(){
            var scope = document.querySelector('neon-animated-pages [id="system_info"]');
            if(scope.selected==0)
                this.fire('go-back');
            else{
                scope.entryAnimation = 'slide-from-left-animation';
                scope.exitAnimation = 'slide-right-animation';
                scope.selected =0;
            }
        },
        go_next: function(){
            var scope = document.querySelector('neon-animated-pages [id="system_info"]');
            if(scope.selected!=1){
                scope.entryAnimation = 'slide-from-right-animation';
                scope.exitAnimation = 'slide-left-animation';
                scope.selected = 1;
            }
        },
        _onItemClick: function(event) {
            var item = event.detail.data;
            if(item)
                this.$.full_file.content = item.content;
            this.$.log_files.selected = 1;
        },
        _onClose: function(event) {
            this.$.log_files.selected = 0;
        },

        downloadLog: function(event){
            //history.pushState(null,null,"/downloadLogs?id="+this.sim.id);
            this.$.download_log_form.submit();
        },

        attached: function () {

            Highcharts.setOptions({
                global : {
                    useUTC : false
                }
            });
            var x = 0,y=0;
            // Create the chart
            $('#SystemCPUMonitor').highcharts({
                chart : {
                    type:'spline',
                    events : {
                        load : function () {

                            // set up the updating of the chart each second
                            var series = this.series[0];
                            setInterval(function () {
                                        x =0;
                                        y = Math.random()*100;
                                series.addPoint([x, y], true, true);
                            }, 1000);
                        }
                    }
                },
                credits: {
                    enabled: false
                },
                title : {
                    text : 'Live random data'
                },

                exporting: {
                    enabled: false
                },
                xAxis: {
                    reversed:true,
                    type: 'linear',
                    tickInterval: 20,
                    max:60,
                    min:0
                },
                yAxis: {
                    tickInterval:50,
                    max:100,
                    min:0
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: false
                        }
                    }
                },
                series : [{
                    name : 'ii',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                                i;

                        for (i = 0; i < 60; i++) {
                            data.push({
                                x:i,
                                y: Math.random() * 100
                            });
                        }
                        return data;
                    }())
                }]
            });

        }

    });


</script>